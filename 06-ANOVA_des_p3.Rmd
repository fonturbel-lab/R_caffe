---
title: "06 - Other ANOVA designs part 3"
author: "Francisco E. Fonturbel"
date: "28/June/2022"
output: 
  html_document:
    includes:
        after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

## Repeated measures ANOVA

A common task is measuring the same experimental unit in multiple times. For example, we have plants growing under three different treatments and we measure plant height as a response variable, but we measure our plant every week for two months. So, we cannot consider each measurement as an independent data point as they represent pseudo-replicates. Thus, we cannot run a simple one-way ANOVA with such data, but we can run a **repeated measures ANOVA** instead to correct our data indicating R that we have sampled the same experimental unit _t_ times.

```{r data}
#Let's load the data file
data<-read.table("data/06-repeated.txt", header = T)

data$id <- factor(data$id)
data$workout <- factor(data$workout)
data$diet <- factor(data$diet)
data$time <- factor(data$time)
attach(data)
```


Our example data is based on some athletes that had three different workout schemes and three different diets, and we measured their pulse (as a response variable) three times during the experiment. Thus, our fixed factors are workout scheme and diet (athletes received different combinations of those factors), and the column _time_ represent the repeated measured.


Let's fit a repeated measures ANOVA model with this:

```{r ANOVA.r}
rm.aov <- aov(pulse ~ diet * workout * time + Error(id) )
```

OK, now we have an object called `aov.infest`, now we'll use the `summary()` function to see the results:

```{r result_aov_r}
summary(rm.aov)
```

Our show that diet had a **significantly effect** on athletes' pulse, but not workout scheme or the intearaction of both. Further, the repeated measures showed that pulse changed over time and this change was related to diet.


## ANCOVA (Analysis of Covariance)

Until now we have used categorical factors

Let's use an example from Quinn (1988), in which we have the mean number of eggs as a response variable with two factors: season and density treatments.

```{r data2}
dataf<-read.csv("data/05-quinn.csv", header = TRUE, sep = ",")
attach(dataf)
```

We may fit independent ANOVAs for each factor:

```{r aov1}
aov.season<-aov(EGGS~SEASON, data = dataf)
summary(aov.season)
```

OK, season matters.

Now let's examine density effects:

```{r aov2}
aov.dens<-aov(EGGS~DENSITY, data = dataf)
summary(aov.dens)
```

Well, density also matters. We have two significant ANOVA results, but what is the joint effect of them?

Let's conduct a two-way ANOVA:

```{r aov3}
aov.2w<-aov(EGGS~SEASON+DENSITY, data = dataf)
summary(aov.2w)
```

As expected, both terms are significant. But this does not resolves the problem.

Let's examine the interaction model (replacing + for *):

```{r aov4}
aov.int<-aov(EGGS~SEASON*DENSITY, data = dataf)
summary(aov.int)
```

Nice! while both terms are significant, the interaction is not significant, meaning that both factors have similar slopes and respond in the same way. A signoficant interaction means that when one factor increases, the other one decreased.

What if we ONLY want the interaction term? just replace * by :


```{r aov5}
aov.intonly<-aov(EGGS~SEASON:DENSITY, data = dataf)
summary(aov.intonly)
```

Let's make a simple boxplot to see how it looks like:

```{r bp, fig.width=12}
boxplot(EGGS~SEASON:DENSITY, col = "dodgerblue2", data = dataf)
```


### Including an error term

Let's assume that we only care about the season in the last example, but we need to account for egg density (as an error term).

```{r aov6}
aov.err<-aov(EGGS~SEASON + Error(DENSITY), data = dataf)
summary(aov.err)
```

What are we looking here? We are examining the effects of season on the mean number of eggs, but corrected by the egg density variability.


## Final thoughts

Nested and Factorial ANOVA designs allow us to analyze more complex experiments and obtain reliable estimates taking those aspects in consideration. It is important to have these issues in mind when we are proposing a research project, as we need to think ahead in the statistical analyses to be used before going to the field and collect our data. Otherwise, if we perform a flawed design and collected field data, analyzing such data will be difficult and probably our results might be unreliable.

## Session

```{r session, echo=TRUE}
sessionInfo()
```
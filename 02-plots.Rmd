---
title: "02 - Making awesome plots in R"
author: "Francisco E. Fonturbel"
date: "24/May/2022"
output: 
  html_document:
    includes:
        after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

## The art of making graphics in R

R is a powerful graphic engine too. But we have to learn some things before we can produce awesome plots for our reports and papers. When R become popular, most people acknowledged it statistical power but criticized its limited ability to produce quality graphics. Basic R plots were plain and dull, and often needed tweaking in an external software (e.g., Adobe Illustrator). However, now the situation is quite different thanks to the arrival of `ggplot`, which have introduced a new way to produce high-quality plots of almost everything using an universal grammar.

This lesson contains some examples developed by Naupaka Zimmerman during an ESA workshop in 2019.

```{r packages}
library(ggplot2)
library(ggthemes)
library(tidyr)
library(dplyr)
library(gapminder)
library(scales)
```

So, with the `ggplot2` R library we can go from this:

```{r ugly}
plot(gdpPercap ~ lifeExp, data = gapminder, col = gapminder$continent)
```


To this:

```{r awesome}
ggplot(gapminder, aes(x = gdpPercap, y = lifeExp)) +
  geom_point(shape = 1, aes(color = continent)) +
  stat_smooth(method = "lm", size = 1, color = "black") +
  scale_x_log10() + 
  xlab("Per Capita GDP") + 
  ylab("Life Expectancy (yrs)") +
  facet_wrap(~continent) +
  theme_few() + 
  guides(color = "none")
```


Or making something more elaborate:

```{r awesome2}
gapminder <- as.data.frame(gapminder)
conts <- unique(gapminder[,"continent"])
cols <- scales::hue_pal()(length(conts))
par(mfrow = c(2,3))
counter <- 1
for (i in conts) {
  plot(gapminder[which(gapminder$continent == i), "gdpPercap"],
       gapminder[which(gapminder$continent == i), "lifeExp"], col = cols[counter],
       xlab = "Per Capita GDP", ylab = "Life Expectancy (yrs)",
       main = i, las = 1, log = "x")
  fit <- lm(gapminder[which(gapminder$continent == i), "lifeExp"] ~ log(gapminder[which(gapminder$continent == i), "gdpPercap"]))
  pred <- predict(fit, interval = "confidence")
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,1]))
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,2]), lty = 2)
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,3]), lty = 2)
  counter <- counter + 1
}
```

##  So, Why ggplot?

* Is more elegant and compact code than with base graphics
* Has more aesthetically pleasing defaults than lattice
* Uses a set of terms that defines the basic components of a plot
* Used to produce figures using coherent, consistant syntax
* Supports a continuum of expertise
* Easy to get started, plenty of power for complex figures 33

## The ggplot grammar

### Data

* Must be a data frame (```data.frame()```, ```as.data.frame()```)
* Gets pulled into the ```ggplot()``` object


### Aesthetics

* How your data are represented visually (i.e., mapping)
* Which data on the x?
* Which data on the y?
* Also defines color, shape, groups, etc.

### Geometries

* The geometric objects in the plot
* Points, lines, polygons, etc.
* Related functions: ```geom_point()```, ```geom_bar()```, ```geom_line()```

## Starting from the very basic

Remember our old friend, the _iris_ dataset? Let's to some basic plotting:

```{r basic1}
ggplot(data = iris, aes(x = Sepal.Length, y = Sepal.Width)) +
  geom_point()
```

Not very fancy, right? hahahaha

That if we create a custom theme to tell R and `ggplot2` how we like our plot

```{r grooming}
##Some ggplot2 grooming
My_Theme = theme(
  axis.title.x = element_text(size = 20,face="bold"),
  axis.text.x = element_text(size = 16),
  axis.text.y = element_text(size = 16),
  axis.title.y = element_text(size = 20,face="bold"),
  legend.text = element_text(size = 14),
  legend.title = element_text(size = 14,face="bold"),
  panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  panel.background = element_rect(fill = "white"),
  plot.title = element_text(size = 20,face="bold"))
```

```{r basic2}
ggplot(data = iris, aes(x = Sepal.Length, y = Sepal.Width, col = Species)) +
  geom_point() +
  My_Theme
```

Better, right?

## Pre-processing our data to make better graphics

We will use the `dplyr` library to summarize the iris data, then make the plot below.

```{r iris-summ}
iris_agg <- iris %>%
  group_by(Species) %>%
  summarise(mean_petal_len = mean(Petal.Length),
            sd_petal_len = sd(Petal.Length))
```

```{r iris-summ2, echo=F}
ggplot(iris_agg, aes(x = Species, y = mean_petal_len, color = Species)) +
  geom_point() +
  geom_errorbar(aes(ymin = mean_petal_len - sd_petal_len,
                    ymax = mean_petal_len + sd_petal_len), width = 0.15) +
  xlab("Species") +
  ylab("Mean Petal Length") +
  guides(color=FALSE) +
  theme_few()
```

## Final thoughts

R is a useful graphic tool to produce high-quality plots

## Session

```{r session, echo=TRUE}
sessionInfo()
```
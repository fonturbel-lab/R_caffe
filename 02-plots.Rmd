---
title: "02 - Making awesome plots in R"
author: "Francisco E. Fonturbel"
date: "24/May/2022"
output: 
  html_document:
    includes:
        after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

## The art of making graphics in R

R is a powerful graphic engine too. But we have to learn some things before we can produce awesome plots for our reports and papers. When R become popular, most people acknowledged it statistical power but criticized its limited ability to produce quality graphics. Basic R plots were plain and dull, and often needed tweaking in an external software (e.g., Adobe Illustrator). However, now the situation is quite different thanks to the arrival of `ggplot`, which have introduced a new way to produce high-quality plots of almost everything using an universal grammar.

This lesson contains some examples developed by Naupaka Zimmerman during an ESA workshop in 2019.

```{r packages}
library(ggplot2)
library(ggthemes)
library(tidyr)
library(dplyr)
library(gapminder)
library(scales)
```

So, with the `ggplot2` R library we can go from this:

```{r ugly}
plot(gdpPercap ~ lifeExp, data = gapminder, col = gapminder$continent)
```


To this:

```{r awesome}
ggplot(gapminder, aes(x = gdpPercap, y = lifeExp)) +
  geom_point(shape = 1, aes(color = continent)) +
  stat_smooth(method = "lm", size = 1, color = "black") +
  scale_x_log10() + 
  xlab("Per Capita GDP") + 
  ylab("Life Expectancy (yrs)") +
  facet_wrap(~continent) +
  theme_few() + 
  guides(color = "none")
```


Or making something more elaborate:

```{r awesome2}
gapminder <- as.data.frame(gapminder)
conts <- unique(gapminder[,"continent"])
cols <- scales::hue_pal()(length(conts))
par(mfrow = c(2,3))
counter <- 1
for (i in conts) {
  plot(gapminder[which(gapminder$continent == i), "gdpPercap"],
       gapminder[which(gapminder$continent == i), "lifeExp"], col = cols[counter],
       xlab = "Per Capita GDP", ylab = "Life Expectancy (yrs)",
       main = i, las = 1, log = "x")
  fit <- lm(gapminder[which(gapminder$continent == i), "lifeExp"] ~ log(gapminder[which(gapminder$continent == i), "gdpPercap"]))
  pred <- predict(fit, interval = "confidence")
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,1]))
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,2]), lty = 2)
  lines(sort(gapminder[which(gapminder$continent == i), "gdpPercap"]), sort(pred[,3]), lty = 2)
  counter <- counter + 1
}
```

# Why ggplot?

##  Why ggplot?
* More elegant and compact code than with base graphics
* More aesthetically pleasing defaults than lattice
* Very powerful for exploratory data analysis

## Why ggplot?
* \alert{gg} is for \alert{grammar of graphics} (term by Lee Wilkinson)
* A set of terms that defines the basic components of a plot
* Used to produce figures using coherant, consistant syntax

##  So, why ggplot?
* Supports a continuum of expertise
* Easy to get started, plenty of power for complex figures 


# The Grammar

##  Some terminology
### Data
* Must be a data frame (```data.frame()```, ```as.data.frame()```)
* Gets pulled into the ```ggplot()``` object

##  tidyr
Helps your data play nice with ggplot


# Aesthetics

## Some terminology
### \alert{aes}thetics
* How your data are represented visually 
  + a.k.a. mapping
* which data on the x
* which data on the y
* but also: \textcolor{red}{color}, \LARGE{size}, \normalsize{shape, transparency}

# Geometries

## Some terminology
### \alert{geom}etry
* The geometric objects in the plot
* points, lines, polygons, etc.
* functions: ```geom_point()```, ```geom_bar()```, ```geom_line()```

## Final thoughts

R is a useful graphic tool to produce high-quality plots

## Session

```{r session, echo=TRUE}
sessionInfo()
```
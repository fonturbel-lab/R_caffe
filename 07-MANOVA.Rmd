---
title: "07 - MANOVA"
author: "Francisco E. Fonturbel"
date: "03/July/2022"
output: 
  html_document:
    includes:
        after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

## Multivariate ANOVA

Until now, we operated ANOVA tests using one or more factors (or even a covariate) against a single response variable. But, what if we have two or more response variables? Is not rare that we measure several response attributes on a study system. So, if we have multiple response variables we could perform individual ANOVA tests for each response variable, but doing this represents two problems: (1) we cannot account for the global effect based on individual tests, and (2) we would have to correct our P-values for multiple comparisons.

Fortunately, there is an alternative for this: The Multivariate Analysis of Variance, aka **MANOVA**. Let's see this example data:

```{r data}
#Let's load the data file
data<-read.table("data/07_manova.txt", header = T)
attach(data)
head(data)
```

Our example presents data for polluted and non-polluted sites in which a rodent species occurs. We sampled seven heavy metals (Arsenic, Copper, Cadmium, Lead, Tin, Antimony, and Zinc) at the rodent tissue (_T samples) as well as in the soil (_E samples). So, we want to know if the heavy metal load (i.e., considering all elements together as response variable) vary between polluted and non-polluted sites. Also, we want to know if male and female rodents have different heavy metal loads, and if the contact or the consumption of plants from the polluted soil have an effect on heavy metal loads.


Let's fit a repeated measures ANOVA model with this:

```{r ANOVA.r}
rm.aov <- aov(pulse ~ diet * workout * time + Error(id) )
```

OK, now we have an object called `aov.infest`, now we'll use the `summary()` function to see the results:

```{r result_aov_r}
summary(rm.aov)
```

Our show that diet had a **significantly effect** on athletes' pulse, but not workout scheme or the intearaction of both. Further, the repeated measures showed that pulse changed over time and this change was related to diet.


## ANCOVA (Analysis of Covariance)

So far we have used categorical factors, but what about continuous covariates? We may have a non-categorical variable that is not our analysis focus we know that it can influence our results (e.g., altitute). Therefore, in these cases we need to use an **Analysis of Covariance** (ANCOVA for short).

Let's use an example data in which we have fecundity as a response variable, site and microhabitat as fixed factors, and individual size as a continuous covariate.

```{r data2}
library(car)

dataf<-read.table("data/06-ancova.txt", header = TRUE)

dataf$site <- factor(dataf$site, ordered=T)
dataf$microhab <-factor(dataf$microhab, ordered=T)

attach(dataf)
```


And now we can fit the `ANCOVA`:

```{r ancova}
fecund.lm <- lm(lnfecund ~ size + site * microhab)
fecund.ancova <- Anova(fecund.lm, type = 'III')
summary(fecund.lm)
print(fecund.ancova)
```

Our results show that our covariate has a significant effect on our results altogether with site and microhabitat.

Now let's examine some plots to see how residuals are distributed:

```{r acvplot}
par(mfrow=c(2,2))
plot(fecund.lm)
par(mfrow=c(1,1))
```


## Final thoughts

Repeated measures ANOVA and ANCOVA allow us to conduct more complex ANOVA models by including temporal replication (and overcome the pseudoreplication problem) and to include a continuous covariate to account to such variability in our comparisons.

## Session

```{r session, echo=TRUE}
sessionInfo()
```
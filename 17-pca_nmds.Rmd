---
title: "17 - PCA and nMDS"
author: "Francisco E. Fonturbel"
date: "04/January/2023"
output: 
  html_document:
    includes:
        after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

## Dealing with multiple variables at once

Dealing with biodiversity data is somewhat different than dealing with the usual stuff that we are (now) used to. Besides formal tests, there are some multivariate tests that allow us to conduct a visual exploration of our data, instead than testing an hypothesis.


```{r data}
library(dplyr)
library(ggplot2)
library(ggsci)
library(ggpubr)
library(vegan)
library(ade4)
library(ecodist)
library("factoextra")

#Loading work data
data = read.csv("data/17_monito_hab.csv",
                   header=TRUE,
                   sep=",")
attach(data)
head(data)
```

```{r grooming, include=FALSE, warning=FALSE, message=FALSE}
#Enabling multiplot capabilities
source("multiplot.R")

##Some ggplot2 grooming
My_Theme2 = theme(
  axis.title.x = element_text(size = 20,face="bold"),
  axis.text.x = element_text(size = 16),
  axis.text.y = element_text(size = 16),
  axis.title.y = element_text(size = 20,face="bold"),
  legend.text = element_text(size = 14),
  legend.title = element_text(size = 14,face="bold"),
  panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  panel.background = element_rect(fill = "white"),
  plot.title = element_text(size = 20,face="bold"))
```

Today we will use some data of [Gonzalez-Ancin et al. 2022](https://www.cambridge.org/core/journals/oryx/article/intermediate-levels-of-wood-extraction-may-facilitate-coexistence-of-an-endemic-arboreal-marsupial-and-indigenous-communities/7E08676B30B1C4392BF34522D495EDB2) as a working example. This dataset contains habitat structure variables of three forests stands in which we captured _Dromiciops gliroides_ nearby the Pucatrihue bay.

## Analysis of Principal Components (PCA)

The Analysis of Principal Components reduces many variables to a few dimensions (usually two or three) calllen "principal components" that are orthologous (i.e., independent) from each other. Principal components are always arranged from the one that explains most of the data variance to the least. Each principal component has an associated eigenvector that is a proxy of its importance, usually eigenvalues >1 are meaningful.

```{r str_pca, echo=FALSE, message=FALSE, warning=FALSE}
cols<-c(7,32,42,44,45)
habstr <- data [, cols]

#Now the PCA
pc1 <- prcomp(habstr, scale. = T)
summary(pc1)

#PCA eigenvalues
R<-cor(habstr)
miEig<-eigen(R)
miEig

#PCA plots
#biplot(pc1)


#habdata2<-dudi.pca(habstr, center = TRUE, scale=TRUE, scan=FALSE)
#coul <- c("blue", "green", "orange", "red")
#s.class(habdata2$li, fac=data$grid, cpoint = 1, col = coul)

#s.corcircle(habdata2$co, lab = names(habstr), full = FALSE, box = TRUE)

fviz_pca_biplot(pc1, label="var", habillage=data$grid,addEllipses=TRUE, ellipse.level=0.95)
```

The resulting plot shows each forest stand (G1, G2, and G3) and the arrows represent the variables and their relative contribution to the first to principal components (PC1 and PC2).

## Final thoughts

PCA and nMDS


## Session

```{r session, echo=TRUE}
sessionInfo()
```
---
title: "05 - Other ANOVA designs part 2"
author: "Francisco E. Fonturbel"
date: "14/June/2022"
output: 
  html_document:
    includes:
        after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

## Nested ANOVA

In some opportunities, we have more than one factor explaining our response variable. If those factors are independent, we simply use a two-way ANOVA design, but what if one factor is a subset of the other? Let's imagine that we measured plant diameter in three populations, and at each population we set three experimental treatments: control, half water and 10% water. So, we will have the water treatment factor nested within the population factor. Thus, each treatment constitutes a sub-replicate of each population replicate. Therefore, it won't be correct to treat this as a two-way ANOVA; we need to use a Nested ANOVA design instead. Let's see some example data:

```{r data}
#Let's load the data file
data<-read.table("data/04-cactus.txt", header = T)
attach(data)
```


Now we have our data properly ordered. Let's fit a one-way ANOVA model with this:

```{r ANOVA.r}
aov.cactus.r <- aov(r ~ tm)
```

OK, now we have an object called `aov.cactus.r`, now we'll use the `summary()` function to see the results:

```{r result_aov_r}
summary(aov.cactus.r)
```

Our results indicate that cactus height is **significantly different** among the three sampled population.


## Factorial ANOVA

Now, let's go further and get acquianted with the **randomized block design**. In this kind of model, similar test subjects are grouped in **blocks** and each block is tested against all treatment levels of the primary factor, at a random order. This approach is intended to get rid of possible influences of external factors (e.g., slope or sunlight incidence).


In a further step, we need to define the blocks:

```{r blocks}
blk = gl(n, k, k*n)             # blocking factor
```


Now we have our data properly ordered blocks, let's fit a one-way ANOVA model with this:

```{r ANOVAb}
aov.cactus.b <- aov(r ~ tm + blk)
```

OK, now we have an object called `aov.cactus`, now we'll use the `summary()` function to see the results:

```{r result_aov_b}
summary(aov.cactus.b)
```

Our results indicate that cactus height is **significantly different** among the three sampled population. However, the block factor `blk` is not significant, indicating that the influence of environmental heterogeneity within populations is negligible.


## Final thoughts

ANOVA is quite a flexible test that allows to consider some sources of variation to obtain more reliable results. If we suspect that external factors may be affecting our data, using a randomized block design may be a good option.

## Session

```{r session, echo=TRUE}
sessionInfo()
```